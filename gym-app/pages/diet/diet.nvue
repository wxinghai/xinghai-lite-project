<template>
	<view class="container">
		<!-- ÊêúÁ¥¢Ê†è -->
		<view class="search-bar">
			<view class="search-box" @click="focusSearch">
				<text class="search-icon">üîç</text>
				<input 
					class="search-input" 
					placeholder="ËæìÂÖ•Âä®‰ΩúÂêçÂ≠óÊêúÁ¥¢" 
					placeholder-style="color: #999;" 
					confirm-type="search"
					v-model="searchKeyword"
					@confirm="searchFood"
					ref="searchInput"
				/>
			</view>
			<text class="add-icon" @click="addFood">+</text>
		</view>
		
		<!-- È•ÆÈ£üËÆ∞ÂΩïÊ®°Âùó -->
		<view class="diet-record">
			<text class="diet-title">È•ÆÈ£üËÆ∞ÂΩï</text>
			
			<!-- È•ÆÈ£ü‰ø°ÊÅØÂç°Áâá -->
			<view class="diet-card">
				<view class="diet-header">
					<text class="diet-current">Â∑≤ËøõÈ£ü {{ dietData.consumed }}</text>
					<text class="diet-total">/ {{ dietData.target || '--' }} Â§ßÂç°</text>
				</view>
				
				<!-- Ëê•ÂÖªÁ¥†ÁΩëÊ†º -->
				<view class="nutrition-grid">
					<!-- ËõãÁôΩË¥® -->
					<view class="nutrition-item protein">
						<text class="nutrition-name">ËõãÁôΩ(g)</text>
						<text class="nutrition-value">{{ dietData.protein }}</text>
						<text class="nutrition-percent">{{ dietData.proteinPercent }}%</text>
					</view>
					
					<!-- Á¢≥Ê∞¥ -->
					<view class="nutrition-item carb">
						<text class="nutrition-name">Á¢≥Ê∞¥(g)</text>
						<text class="nutrition-value">{{ dietData.carbs }}</text>
						<text class="nutrition-percent">{{ dietData.carbsPercent }}%</text>
					</view>
					
					<!-- ËÑÇËÇ™ -->
					<view class="nutrition-item fat">
						<text class="nutrition-name">ËÑÇËÇ™(g)</text>
						<text class="nutrition-value">{{ dietData.fat }}</text>
						<text class="nutrition-percent">{{ dietData.fatPercent }}%</text>
					</view>
					
					<!-- È•ÆÊ∞¥ -->
					<view class="nutrition-item water">
						<text class="nutrition-name">È•ÆÊ∞¥(ml)</text>
						<text class="nutrition-value">{{ dietData.water }} / {{ dietData.waterTarget }}</text>
						<text class="nutrition-percent">{{ dietData.waterPercent }}%</text>
					</view>
				</view>
				
				<!-- È¶ñÈ°µÊòæÁ§∫ÈÄâÈ°π -->
				<view class="display-option" @click="toggleDisplayInHome">
					<view class="option-circle" :class="{ 'checked': displayInHome }"></view>
					<text class="option-text">Âú®È¶ñÈ°µÊòæÁ§∫È•ÆÈ£üÊ®°Âùó</text>
				</view>
			</view>
			
			<!-- Âø´ÈÄüÊìç‰ΩúÊåâÈíÆ -->
			<view class="quick-actions">
				<view class="action-row">
					<!-- Êñ∞Âª∫ËÆ≠ÁªÉ -->
					<view class="action-btn" @click="navigateTo('new-training')">
						<view class="action-icon blue">
							<text class="action-icon-text">üèãÔ∏è</text>
						</view>
						<text class="action-text">Êñ∞Âª∫ËÆ≠ÁªÉ</text>
					</view>
					
					<!-- Êñ∞Âª∫ÊúâÊ∞ß -->
					<view class="action-btn" @click="navigateTo('new-cardio')">
						<view class="action-icon teal">
							<text class="action-icon-text">üèÉ</text>
						</view>
						<text class="action-text">Êñ∞Âª∫ÊúâÊ∞ß</text>
					</view>
					
					<!-- Êñ∞Âª∫HIIT -->
					<view class="action-btn" @click="navigateTo('new-hiit')">
						<view class="action-icon yellow">
							<text class="action-icon-text">üèÉ‚Äç‚ôÇÔ∏è</text>
						</view>
						<text class="action-text">Êñ∞Âª∫HIIT</text>
					</view>
					
					<!-- Êñ∞Âª∫‰ºëÊÅØ -->
					<view class="action-btn" @click="navigateTo('new-rest')">
						<view class="action-icon purple">
							<text class="action-icon-text">‚òï</text>
						</view>
						<text class="action-text">Êñ∞Âª∫‰ºëÊÅØ</text>
					</view>
				</view>
				
				<view class="action-row">
					<!-- Ë∫´‰ΩìÊï∞ÊçÆ -->
					<view class="action-btn" @click="navigateTo('body-data')">
						<view class="action-icon pink">
							<text class="action-icon-text">üë§</text>
						</view>
						<text class="action-text">Ë∫´‰ΩìÊï∞ÊçÆ</text>
					</view>
					
					<!-- ÁªèÊúüËÆ∞ÂΩï -->
					<view class="action-btn" @click="navigateTo('period-record')">
						<view class="action-icon pink">
							<text class="action-icon-text">üíß</text>
						</view>
						<text class="action-text">ÁªèÊúüËÆ∞ÂΩï</text>
					</view>
				</view>
			</view>
		</view>
		
		<!-- È£üÂìÅÂàÜÁ±ªÂíåÂàóË°® -->
		<scroll-view class="food-container" scroll-y="true" show-scrollbar="false">
			<block v-for="(category, categoryIndex) in foodCategories" :key="categoryIndex">
				<!-- ÂàÜÁ±ªÊ†áÈ¢ò -->
				<view class="category-title">
					<text class="category-title-text">{{ category.name }}</text>
				</view>
				
				<!-- È£üÂìÅÂàóË°® -->
				<view class="action-list">
					<!-- È£üÂìÅË°å -->
					<view class="action-row" v-for="(row, rowIndex) in Math.ceil(category.foods.length / 2)" :key="rowIndex">
						<!-- Â∑¶‰æßÈ£üÂìÅ -->
						<view 
							class="action-item" 
							v-if="category.foods[(row-1)*2]"
							@click="viewFoodDetail(category.foods[(row-1)*2])"
						>
							<view class="action-tutorial" v-if="category.foods[(row-1)*2].hasNutritionInfo">
								<text class="tutorial-text">Ëê•ÂÖª</text>
							</view>
							<image 
								class="action-image" 
								:src="category.foods[(row-1)*2].image || '/static/foods/default.png'" 
								mode="aspectFill"
							></image>
							<text class="action-name">{{ category.foods[(row-1)*2].name }}</text>
						</view>
						
						<!-- Âè≥‰æßÈ£üÂìÅ -->
						<view 
							class="action-item" 
							v-if="category.foods[(row-1)*2+1]"
							@click="viewFoodDetail(category.foods[(row-1)*2+1])"
						>
							<view class="action-tutorial" v-if="category.foods[(row-1)*2+1].hasNutritionInfo">
								<text class="tutorial-text">Ëê•ÂÖª</text>
							</view>
							<image 
								class="action-image" 
								:src="category.foods[(row-1)*2+1].image || '/static/foods/default.png'" 
								mode="aspectFill"
							></image>
							<text class="action-name">{{ category.foods[(row-1)*2+1].name }}</text>
						</view>
						
						<!-- Á©∫ÁôΩÂç†‰Ωç -->
						<view class="action-item placeholder" v-if="(row-1)*2+1 >= category.foods.length"></view>
					</view>
				</view>
			</block>
		</scroll-view>
	</view>
</template>

<script>
	export default {
		data() {
			return {
				searchKeyword: '',
				displayInHome: false,
				dietData: {
					consumed: 0,
					target: 2500,
					protein: 0,
					proteinPercent: 0,
					carbs: 0,
					carbsPercent: 0,
					fat: 0,
					fatPercent: 0,
					water: 0,
					waterTarget: 2000,
					waterPercent: 0
				},
				foodCategories: [
					{
						name: 'Êù†ÈìÉ',
						foods: [
							{
								id: 1,
								name: 'Êù†ÈìÉÂçßÊé®',
								image: '/static/actions/bench-press.png',
								hasNutritionInfo: true
							},
							{
								id: 2,
								name: 'ÊöÇÂÅúÂçßÊé®',
								image: '/static/actions/pause-press.png',
								hasNutritionInfo: true
							}
						]
					},
					{
						name: 'ÂìëÈìÉ',
						foods: []
					}
				]
			}
		},
		onLoad() {
			uni.setNavigationBarTitle({
				title: 'È•ÆÈ£üËÆ∞ÂΩï'
			});
			
			// Ê®°ÊãüËé∑ÂèñÈ•ÆÈ£üÊï∞ÊçÆ
			this.getDietData();
		},
		methods: {
			focusSearch() {
				this.$nextTick(() => {
					this.$refs.searchInput.focus();
				});
			},
			searchFood() {
				if (!this.searchKeyword.trim()) return;
				
				uni.showToast({
					title: 'ÊêúÁ¥¢: ' + this.searchKeyword,
					icon: 'none'
				});
				
				// ÂÆûÈôÖÂ∫îÁî®‰∏≠‰ºöË∞ÉÁî®ÊêúÁ¥¢API
			},
			addFood() {
				uni.showToast({
					title: 'Ê∑ªÂä†È£üÂìÅ',
					icon: 'none'
				});
				
				// ÂÆûÈôÖÂ∫îÁî®‰∏≠ÂèØ‰ª•ÊâìÂºÄÊ∑ªÂä†È£üÂìÅÁöÑË°®Âçï
			},
			toggleDisplayInHome() {
				this.displayInHome = !this.displayInHome;
				
				uni.showToast({
					title: this.displayInHome ? 'Â∑≤Ê∑ªÂä†Âà∞È¶ñÈ°µÊòæÁ§∫' : 'Â∑≤‰ªéÈ¶ñÈ°µÁßªÈô§',
					icon: 'none'
				});
			},
			navigateTo(page) {
				uni.showToast({
					title: `Ë∑≥ËΩ¨Âà∞ ${page} È°µÈù¢`,
					icon: 'none'
				});
				
				// ÂÆûÈôÖÂ∫îÁî®‰∏≠ÂèØ‰ª•Ë∑≥ËΩ¨Âà∞ÂØπÂ∫îÈ°µÈù¢
				// uni.navigateTo({
				//   url: `/pages/${page}/${page}`
				// });
			},
			viewFoodDetail(food) {
				uni.showToast({
					title: `Êü•ÁúãÈ£üÂìÅ: ${food.name}`,
					icon: 'none'
				});
				
				// ÂÆûÈôÖÂ∫îÁî®‰∏≠ÂèØ‰ª•Ë∑≥ËΩ¨Âà∞È£üÂìÅËØ¶ÊÉÖÈ°µ
				// uni.navigateTo({
				//   url: `/pages/food-detail/food-detail?id=${food.id}`
				// });
			},
			getDietData() {
				// Ê®°Êãü‰ªéAPIËé∑ÂèñÊï∞ÊçÆ
				// ÂÆûÈôÖÂ∫îÁî®‰∏≠‰ºö‰ªéÊúçÂä°Âô®Ëé∑ÂèñÊï∞ÊçÆ
				setTimeout(() => {
					this.dietData = {
						consumed: 1250,
						target: 2500,
						protein: 65,
						proteinPercent: 45,
						carbs: 120,
						carbsPercent: 30,
						fat: 40,
						fatPercent: 25,
						water: 800,
						waterTarget: 2000,
						waterPercent: 40
					};
				}, 500);
			}
		}
	}
</script>

<style>
	.container {
		flex: 1;
		flex-direction: column;
		background-color: #f5f5f5;
	}
	
	.search-bar {
		flex-direction: row;
		padding: 20rpx;
		align-items: center;
		background-color: #f0f0f0;
	}
	
	.search-box {
		flex: 1;
		flex-direction: row;
		align-items: center;
		background-color: #fff;
		border-radius: 40rpx;
		padding: 15rpx 30rpx;
		margin-right: 20rpx;
	}
	
	.search-icon {
		font-size: 32rpx;
		color: #999;
		margin-right: 10rpx;
	}
	
	.search-input {
		flex: 1;
		height: 60rpx;
		font-size: 28rpx;
	}
	
	.add-icon {
		width: 70rpx;
		height: 70rpx;
		background-color: #0A84FF;
		border-radius: 35rpx;
		text-align: center;
		line-height: 60rpx;
		color: #fff;
		font-size: 50rpx;
	}
	
	.diet-record {
		padding: 20rpx;
	}
	
	.diet-title {
		font-size: 36rpx;
		font-weight: bold;
		color: #333;
		margin-bottom: 20rpx;
	}
	
	.diet-card {
		background-color: #fff;
		border-radius: 16rpx;
		padding: 30rpx;
		margin-bottom: 30rpx;
	}
	
	.diet-header {
		flex-direction: row;
		align-items: flex-end;
		margin-bottom: 30rpx;
	}
	
	.diet-current {
		font-size: 36rpx;
		font-weight: bold;
		color: #333;
	}
	
	.diet-total {
		font-size: 28rpx;
		color: #999;
	}
	
	.nutrition-grid {
		flex-direction: row;
		flex-wrap: wrap;
		justify-content: space-between;
		margin-bottom: 30rpx;
	}
	
	.nutrition-item {
		width: 48%;
		height: 180rpx;
		border-radius: 16rpx;
		padding: 20rpx;
		margin-bottom: 20rpx;
		flex-direction: column;
		justify-content: center;
	}
	
	.nutrition-item.protein {
		background-color: #fff5e6;
	}
	
	.nutrition-item.carb {
		background-color: #e6f4ff;
	}
	
	.nutrition-item.fat {
		background-color: #ffe6e6;
	}
	
	.nutrition-item.water {
		background-color: #e6fffa;
	}
	
	.nutrition-name {
		font-size: 28rpx;
		color: #999;
		margin-bottom: 10rpx;
	}
	
	.nutrition-value {
		font-size: 36rpx;
		font-weight: bold;
		color: #333;
		margin-bottom: 10rpx;
	}
	
	.nutrition-percent {
		font-size: 24rpx;
		color: #999;
	}
	
	.display-option {
		flex-direction: row;
		align-items: center;
	}
	
	.option-circle {
		width: 40rpx;
		height: 40rpx;
		border-radius: 20rpx;
		border-width: 2rpx;
		border-color: #ccc;
		margin-right: 10rpx;
	}
	
	.option-circle.checked {
		background-color: #0A84FF;
		border-color: #0A84FF;
	}
	
	.option-text {
		font-size: 28rpx;
		color: #666;
	}
	
	.quick-actions {
		flex-direction: column;
	}
	
	.action-row {
		flex-direction: row;
		justify-content: space-around;
		margin-bottom: 30rpx;
	}
	
	.action-btn {
		flex-direction: column;
		align-items: center;
	}
	
	.action-icon {
		width: 100rpx;
		height: 100rpx;
		border-radius: 50rpx;
		justify-content: center;
		align-items: center;
		margin-bottom: 10rpx;
	}
	
	.action-icon.blue {
		background-color: #5eb5f8;
	}
	
	.action-icon.teal {
		background-color: #4cd6c0;
	}
	
	.action-icon.yellow {
		background-color: #f0c54f;
	}
	
	.action-icon.purple {
		background-color: #a78be8;
	}
	
	.action-icon.pink {
		background-color: #ff6b81;
	}
	
	.action-icon-text {
		font-size: 42rpx;
		color: #fff;
	}
	
	.action-text {
		font-size: 26rpx;
		color: #666;
	}
	
	.food-container {
		flex: 1;
	}
	
	.category-title {
		padding: 20rpx;
	}
	
	.category-title-text {
		font-size: 36rpx;
		font-weight: bold;
		color: #333;
	}
	
	.action-list {
		padding: 0 20rpx;
	}
	
	.action-row {
		flex-direction: row;
		justify-content: space-between;
		margin-bottom: 30rpx;
	}
	
	.action-item {
		width: 340rpx;
		background-color: #fff;
		border-radius: 16rpx;
		overflow: hidden;
		position: relative;
	}
	
	.action-item.placeholder {
		background-color: transparent;
	}
	
	.action-tutorial {
		position: absolute;
		top: 10rpx;
		left: 10rpx;
		background-color: #0A84FF;
		padding: 6rpx 16rpx;
		border-radius: 20rpx;
	}
	
	.tutorial-text {
		color: #fff;
		font-size: 24rpx;
	}
	
	.action-image {
		width: 340rpx;
		height: 200rpx;
		background-color: #f0f0f0;
	}
	
	.action-name {
		font-size: 28rpx;
		color: #333;
		padding: 16rpx;
		text-align: center;
	}
</style> 