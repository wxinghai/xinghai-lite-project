# 登录系统说明

## 概述

本系统支持两种登录方式：
1. **微信登录** - 适用于移动端用户
2. **管理员登录** - 适用于后台管理系统

## 登录接口

### 1. 统一登录接口

**接口地址：** `POST /unified/login/login`

**请求参数：**
```json
{
    "loginType": "wx|admin",  // 登录类型：wx(微信登录)、admin(管理员登录)
    "jscode": "string",       // 微信前端jscode(微信登录时必填)
    "role": "string",         // 用户角色(微信登录时可选)
    "phone": "string",        // 手机号(管理员登录时必填)
    "password": "string"      // 密码(管理员登录时必填)
}
```

**响应结果：**
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "token": "jwt_token_string",
        "userRole": "ADMIN|VISITOR|XYJ|JYG",
        "userId": 123
    }
}
```

### 2. 微信登录专用接口

**接口地址：** `POST /login/auto`

**请求参数：**
- `jscode`: 微信前端jscode (必填)
- `role`: 用户角色 (可选)

### 3. 管理员登录专用接口

**接口地址：** `POST /admin/login/login`

**请求参数：**
- `phone`: 手机号 (必填)
- `password`: 密码 (必填)

## 用户角色说明

- `ADMIN`: 运营方
- `VISITOR`: 游客
- `XYJ`: 西有季
- `JYG`: 金月共

## 使用示例

### 微信登录示例
```bash
curl -X POST "http://localhost:8080/unified/login/login" \
  -H "Content-Type: application/json" \
  -d '{
    "loginType": "wx",
    "jscode": "微信前端获取的jscode",
    "role": "VISITOR"
  }'
```

### 管理员登录示例
```bash
curl -X POST "http://localhost:8080/unified/login/login" \
  -H "Content-Type: application/json" \
  -d '{
    "loginType": "admin",
    "phone": "13800138000",
    "password": "123456"
  }'
```

## 数据库表结构

### 微信用户表 (g_wx_user)
```sql
CREATE TABLE g_wx_user (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    open_id VARCHAR(100) NOT NULL COMMENT '微信openId',
    user_role VARCHAR(20) COMMENT '用户角色',
    user_id BIGINT COMMENT '关联的用户ID',
    nickname VARCHAR(100) COMMENT '昵称',
    avatar_url VARCHAR(500) COMMENT '头像URL',
    last_login DATETIME COMMENT '最后登录时间',
    create_time DATETIME COMMENT '创建时间',
    enable VARCHAR(1) DEFAULT '1' COMMENT '是否启用'
);
```

### 管理员表 (g_admin)
```sql
CREATE TABLE g_admin (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    realname VARCHAR(100) NOT NULL COMMENT '真实姓名',
    phone VARCHAR(20) NOT NULL COMMENT '手机号',
    password VARCHAR(100) NOT NULL COMMENT '密码(BCrypt加密)',
    create_time DATETIME COMMENT '创建时间'
);
```

## 安全说明

1. **密码加密**：管理员密码使用BCrypt算法加密存储
2. **JWT Token**：登录成功后返回JWT token，用于后续接口认证
3. **参数验证**：所有登录参数都进行了严格的验证
4. **角色验证**：用户角色在登录时进行有效性验证

## 注意事项

1. 微信登录需要配置正确的微信小程序AppID和AppSecret
2. 管理员登录需要先创建管理员账号
3. JWT token有过期时间，过期后需要重新登录
4. 不同角色的用户可能有不同的权限和功能访问范围 